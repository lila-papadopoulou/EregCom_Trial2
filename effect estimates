*1.ATTENDANCE EFFECT ESTIMATES*
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\outcomes_04112021_nodup.dta", clear

*new vars and vars to keep for this analysis*
*cluster size*
gen clussize= str_TRIAL_2_ClusSize/100 if str_TRIAL_2_ClusSize!=.
label var clussize "cluster size by 100s"
codebook clussize

*phase-relabel categories*
gen phase_n=1 if phase_x=="1"
replace phase_n=2 if phase_x=="2"
replace phase_n=3 if phase_x=="2 Gaza"
label var phase_n "phase"
codebook phase_n

*gen attendace vars to reshape to long"
gen att1=num_15_17 if num_15_17!=.
gen att2=num_18_22 if num_18_22!=.
gen att3=num_24_28 if num_24_28!=. 
gen att4=num_31_33 if num_31_33!=.
gen att5=num_35_37 if num_35_37!=.
label var att1 "attendance 15-17 weeks (numerator)"
label var att2 "attendance 18-22 weeks (numerator)"
label var att3 "attendance 24-28 weeks (numerator)"
label var att4 "attendance 31-33 weeks (numerator)"
label var att5 "attendance 35-37 weeks (numerator)"
codebook att1-att5

gen lab=labavailability_y
label var lab "lab availability"
gen us=usavailability_y
label var us "ultrasound availability"
label var agecat "participant's age at baseline-years"
label var parity "participant's parity- nulli(0)/multi(1)"

gen strata=bookorgdistricthashed 
label var strata "district strata-based on booking info"
codebook strata

codebook uniqueid b_TrialArm  att1-att5  phase_n  str_TRIAL_2_Cluster clussize lab us agecat parity strata  

keep uniqueid b_TrialArm  att1-att5  phase_n  str_TRIAL_2_Cluster clussize lab us agecat parity strata

save "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\attendance_wide.dta", replace
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\attendance_wide.dta", clear

reshape long att, i(uniqueid) j(timepoint)
save "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\attendance_long.dta", replace
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\attendance_long.dta", clear

*A (0) vs. B (1)*
gen AB=0 if b_TrialArm=="A"
replace AB=1 if b_TrialArm=="B"
count if missing(AB)
assert r(N) == 0

*A (0) vs. C (1)*
gen AC=0 if b_TrialArm=="A"
replace AC=1 if b_TrialArm=="C"

*A (0) vs. D (1)*
gen AD=0 if b_TrialArm=="A"
replace AD=1 if b_TrialArm=="D"

*B (0) vs. C (1)*
gen BC=0 if b_TrialArm=="B"
replace BC=1 if b_TrialArm=="C"

*B (0) vs. D (1)* 
gen BD=0 if b_TrialArm=="B"
replace BD=1 if b_TrialArm=="D"

*C (0) vs. D (1)*
gen CD=0 if b_TrialArm=="C"
replace CD=1 if b_TrialArm=="D"

local comparisons "AB AC AD BC BD CD"
foreach x of local comparisons {
   xi:melogit i.att i.`x' i.timepoint i.phase_n i.us i.lab clussize  i.parity i.agecat i.strata|| str_TRIAL_2_Cluster:|| uniqueid:, or
        }

**************************************************************************************************************
*ANEMIA EFFECT ESTIMATES*
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\outcomes_04112021_nodup.dta", clear

gen clussize= str_TRIAL_2_ClusSize/100 if str_TRIAL_2_ClusSize!=.

gen phase_n=1 if phase_x=="1"
replace phase_n=2 if phase_x=="2"
replace phase_n=3 if phase_x=="2 Gaza"

codebook uniqueid phase_x b_TrialArm str_TRIAL_2_Cluster labavailability_y usavailability_y clussize str_TRIAL_2_ClusSize agecat bookbmicat ///
parity educationcat avgincomecat screen_anemia1 screen_anemia2 screen_anemia3 screen_anemia4 screen_anemia2xtra screen_anemia4xtra man_anemia1 ///
man_anemia2 man_anemia3 man_anemia4 man_anemia2xtra man_anemia4xtra success_anemia_1 success_anemia_2 success_anemia_3 success_anemia_4 success_anemia_2xtra phase_n ///
success_anemia_4xtra

keep uniqueid phase_x b_TrialArm str_TRIAL_2_Cluster labavailability_y usavailability_y clussize str_TRIAL_2_ClusSize agecat bookbmicat ///
parity educationcat avgincomecat screen_anemia1 screen_anemia2 screen_anemia3 screen_anemia4 screen_anemia2xtra screen_anemia4xtra man_anemia1 ///
man_anemia2 man_anemia3 man_anemia4 man_anemia2xtra man_anemia4xtra success_anemia_1 success_anemia_2 success_anemia_3 success_anemia_4 success_anemia_2xtra phase_n ///
success_anemia_4xtra

rename screen_anemia2xtra screen_anx2
rename screen_anemia4xtra screen_anx4
rename man_anemia2xtra man_anx2
rename man_anemia4xtra man_anx4
rename success_anemia_2xtra success_anx2
rename success_anemia_4xtra success_anx4

save "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\anemia.dta"
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\anemia.dta", clear

reshape long screen_anx  man_anx success_anx screen_anemia man_anemia success_anemia_, i(uniqueid) j(timepoint)
save "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\anemia_long.dta"
use "C:\Users\elpa\OneDrive - Folkehelseinstituttet\from personmap\Global Health\palestine rct\anemia_long.dta", clear

*SCREENING ONLY*

*MANAGEMENT ONLY*


*SCREENING & MANAGEMENT*


*QID/SMS ARMS*
*SCREENING ONLY*

*MANAGEMENT ONLY*


*SCREENING & MANAGEMENT*
